import os

import openai
import chainlit as cl

from dotenv import load_dotenv
from loguru import logger
from chainlit import user_session
from chainlit.input_widget import Select, Slider, Switch

load_dotenv()

openai.api_key = os.getenv("OPENAI_APIKEY")

model_engine_3 = "gpt-3.5-turbo-16k"
model_engine = "gpt-4"
model_engine = model_engine_3

settings = {
    "temperature": 0.3,
    "max_tokens": 2048,
    "top_p": 1,
    "frequency_penalty": 0,
    "presence_penalty": 0,
}

skagerak_report_txt = """
Skagerak Energy's financial instruments in 2022 and 2021 consist of energy derivatives, interest rate swaps, customer receivables, supplier debt, cash, short-term liquidity placements, equity instruments, and loans.The value and fair value of these financial assets and liabilities are the same for all instruments except for long-term debt and the first year's installment on long-term debt.Power contracts are valued using discounted year-end prices from power exchanges or expected future cash flows based on market price curves.Interest rate swaps are valued using valuation techniques that discount expected future cash flows using observed market rates.Shares and equity instruments are valued at listed prices for liquid securities or by discounting expected future cash flows for other securities.The company classifies fair value measurements into three levels: Level 1 unadjusted quoted prices in active markets, Level 2 other observable data such as prices or derivatives of prices, and Level 3 data that is not based on observable market data.In 2022, the company had other financial assets valued at fair value over profit of 1,000, consisting of 1,000 in long-term shares and equity instruments.In 2021, the company also had 1,000 in long-term shares and equity instruments valued at fair value over profit.Deleide kraftverk er inkludert i konsernresultatetKraftsalgsinntekter for Sira-Kvina, Otra Kraft, og øvrige kraftverk i 2022 er 30 072, 7 630, and 789 millioner kroner, for en total på 38 492 millioner kroner.Andre driftsinntekter for de samme kraftverkene er henholdsvis 7 449, 989, and 2 915 millioner kroner, for en total på 11 353 millioner kroner.Brutto driftsinntekter for deleide kraftverk i 2022 er 37 521 millioner kroner.Total netto driftsinntekter for de samme kraftverkene er 61 269, 31 541, and 1 837 millioner kroner, for en total på 94 648 millioner kroner.Lønnskostnader er 13 618 millioner kroner.Avskrivinger er 10 461 millioner kroner.Konsesjonsavgifter er 8 803 millioner kroner.Andre driftskostnader er 20 097 millioner kroner.Total driftskostnader for deleide kraftverk er 52 979 millioner kroner.Driftsresultat for deleiKompetent: Bruker kunnskap og erfaring for å nå ambisiøse mål og bli anerkjent som ledende innenfor bransjen.Ansvarlig: Skaper verdier med omtanke for medarbeidere, kunder, miljø og samfunn.Nyskapende: Jobber for å forsterke en sentral posisjon i den norske kraftbransjen og bidrar aktivt til utviklingen av denne.Ledestjerne: Skagerak Energi skal være en framtidsrettet leverandør av ren energi for velferd, vekst og utvikling.På lag med en grønn framtid: Samarbeider for å bringe seg i riktig retning mot en grønnere verden.Kjerneverdier: Kompetent, ansvarlig og nyskapende. Alle ansatte skal drives av disse prinsippene.The text describes various statistics related to DRIFTSMARGIN, SYKEFRAVÆR, and ANTALL SKADER EGNE ANSATTE for the years 2013 to 2022. However, the text is not clear and it seems to contain some formatting issues. It is difficult to summarize the information provided in the given text.The text is about Skagerak Energi’s annual report for 2022.The report includes Skagerak01's vision, guiding star, and values.Key figures for the period of 2013-2022 are provided.The company achieved a good result despite uncertain times.The report also covers an overview of the year 2022 and the company's history.Information about Skagerak Energi's facilities is included in the report.Deleide kraftverk med delt eierskap eller rettigheter til uttak av kraft mot kostnadsdekning er ført opp etter verdien av de andres rettigheterFylkeskommuner og offentlig eide energiselskaper har rettigheter til uttak av kraft i kraftanlegg driftet av SkagerakDeleide kraftverk og deres bokførte verdier inkluderer eierandeler, permanente driftsmidler, andre eiendeler, langsiktig gjeld og kortsiktig gjeldSkagerak har eierandeler i flere kraftverk, inkludert Bagn, Finndøla, Folgefonnverkene, Hekni, Otra Kraft, Ulla-Førre, Otteraaens Brugseierforening, Sira-Kvina, Skollenborg, Sundsbarm, and SvelgfossSkageraks eierskap i Otteraaens Brugseierforening er gjennom Otra Kraft DA (31,4%) og Hekni Kraftverk (33,33%)Skageraks eierandel i Skollenborg kraftverk er 48,5% av produksjonsanlegget og 36,03% av damanleggetVarige driftsmidler i Hekni, Folgefonnverkene, Ulla-Førre, Sundsbarm, Bagn, and Svelgfoss blir balanseført og avskrevet direkte i Skagerak Krafts regnskap.Skagerak Energi AS has financial instruments including derivatives.Derivative assets include interest rate swap agreements and energy derivatives.The fair value of derivative assets for the long-term is 0 in 2022 and 2021.Derivative assets for the short-term include interest rate swap agreements and energy derivatives.The fair value of short-term derivative assets is 0 in 2022 and 2021.Derivative liabilities for the long-term include interest rate swap agreements and energy derivatives.The fair value of long-term derivative liabilities is 0 in 2022 and 2021.Derivative liabilities for the short-term include interest rate swap agreements and energy derivatives.The fair value of short-term derivative liabilities is 0 in 2022 and 2021.The text is a financial statement for Skagerak Energi AS in 2022.Finansinntekter (financial income) for 2022 are 88,707, while in 2021 it was 7,946.Konserninterne renteinntekter (intercompany interest income) in 2022 are 133,605, compared to 87,445 in 2021.Andre renteinntekter (other interest income) in 2022 are 22,896, while in 2021 it was only 503.Utbytte (dividends) in 2022 is 48, and in 2021 it was 46.Andre finansinntekter (other financial income) in 2022 are 1,184,921, compared to 30,259 in 2021.Finansinntekter (financial income) for the year 2022 sum up to 156,550, but in 2021 it was 88,002.Finanskostnader (financial expenses) for 2022 are -67,863, while in 2021 it was -89,956.Konserninterne rentekostnader (intercompany interest expenses) in 2022 are -68,220, compared to -90,877 in 2021.Andre rentekostnader (other interest expenses) in 2022 are -5,155, while in 2021 it was -4,905.Verdipapirer realilsert tap (realized losses on securities) in 2022 sum up to 0, but in 2021 it was 0.Andre finanskostnader (other financial expenses) in 2022 are -15, compared to -15 in 2021.Finanskostnader (financial expenses) for the year 2022 sum up to -73,390, but in 2021 it was -95,797.Urealisert verdiendring verdipapirer renteog valutakontrakter (unrealized changes in value of securities, interest, and currency contracts) in 2022 is 5,591, compared to 5,132 in 2021.Rentebytteavtaler verdiendring (interest rate swap value change) in 2022 is 0, but in 2021 it was 0.The sum of these unrealized changes in value for 2022 is 40,684, compared to -107,711 in 2021.The overall sum for finances in 2022 is 83,160, while in 2021 it was -7,795.The text provides information about the fixed assets of Skagerak Energi AS, specifically related to construction projects, buildings, real estate, and movable assets. Here are the key points summarized in bullet points:2022:Balance carried forward on January 1:   Construction projects: NOK 17,741,166  Buildings, real estate, and movable assets: NOK 961,184,701Additions during the year:   Construction projects: NOK 38,671  No additions for buildings, real estate, and movable assetsTransfers between asset groups:   Construction projects: NOK -24,968  No transfers for buildings, real estate, and movable assetsDisposals during the year:   Construction projects: NOK -6,998  No disposals for buildings, real estate, and movable assetsDepreciation:   Construction projects: NOK -25,925  Buildings, real estate, and movable assets: NOK -25,925Accumulated depreciation and impairment losses on disposals:   Construction projects: NOK 6,987  No accumulated depreciation for buildings, real estate, and movable assetsBalance carried forward on December 31:   Construction projects: NOK 31,443,165  Buildings, real estate, and movable assets: NOK 993,197,4362021:Balance carried forward on January 1:   Construction projects: NOK 10,561,177  Buildings, real estate, and movable assets: NOK 464,188,024Additions during the year:   Construction projects: NOK 23,191  No additions for buildings, real estate, and movable assetsTransfers between asset groups:   Construction projects: NOK -16,011  No transfers for buildings, real estate, and movable assetsDisposals during the year:   Construction projects: NOK -3,892  No disposals for buildings, real estate, and movable assetsDepreciation:   Construction projects: NOK -25,025  Buildings, real estate, and movable assets: NOK -25,025Accumulated depreciation and impairment losses on disposals:   Construction projects: NOK 2,404  No accumulated depreciation for buildings, real estate, and movable assetsBalance carried forward on December 31:   Construction projects: NOK 17,741,166  Buildings, real estate, and movable assets: NOK 166,961,184The text is about lease obligations and cash flows related to lease payments.The company Skagerak Energi AS has lease obligations for various time periods.The undiscounted lease obligations for 2022 and 2021 are as follows:  0-1 year: 32,530 in 2022 and 30,836 in 2021  1-5 years: 107,494 in 2022 and 122,900 in 2021  5 years and beyond: 245,004 in 2022 and 263,286 in 2021  Total undiscounted lease obligations per 31.12: 126,283 in 2022 and 147,458 in 2021Skagerak Energi AS leases out office spaces and categorizes these contracts as operational lease agreements.The table shows a schedule of undiscounted lease payments, categorized by time period:  0-1 year: 601,717 in 2022 and 601,717 in 2021  1-5 years: 0 in all years  5 years and beyond: 0 in all years  Total undiscounted lease payments per 31.12: 601,717 in 2022 and 169 in 2021.The given text is a series of numbers and dates, followed by the acronym SAIFI and the mention of a Norwegian company's annual report for 2022.Key points:The numbers represent a scale from 3.0 to 0.0 with increments of 0.5.The dates listed range from 2008 to 2022.SAIFI stands for "Antall langvarige avbrudd pr sluttbruker" in Norwegian, which translates to "Number of long duration interruptions per end-user."The text mentions the annual report of Skagerak Energi for 2022, a company based in Norway.Skagerak Energi's annual report for 2022 shows the following key points:   Electrical energy production: 6307 GWh   Heat production: 138 GWh   Total revenue: 2.2 billion (mrd) kroner   Annual result: 2.5 million kroner after tax   Kraftpris Kristiandsand (NO2) in 2022 resulted in a decreased annual result due to increased grunnrenteskatt and høyprisbidrag.   Extra income from the sale of Fjordkraft in 2019 and 2020 contributed to the annual result.   Prissikring (price hedging) saved the annual result in 2015.   The annual reports cover the years from 2013 to 2022.Social responsibility and sustainability are key focus areasDialogue with stakeholders is emphasizedNet collaboration can save billions for societyEU taxonomy is important for sustainability effortsTransparency law is important for human rights in businessTrygg Partner is replacing diesel with electric to get more contractsClimate-friendly production is a priorityGreen initiative has led to salmon in HjartdølaEmphasis on health, environment, and safetyPeople are a central focusDigital security work is importantMajority of income goes to the public sectorSponsorship plans for 2022Board report and financial statements are includedBoard's annual report is discussedCorporate governance and ownership are mentionedAccounting principles are outlinedNotes to the financial statements are providedAuditor's report is includedSkagerak 4 er et prosjekt som handler om vannkraftMålet med prosjektet er å utnytte vannet til å produsere ren og fornybar energiVed å gjøre dette kan folk ta seg en lang, varm dusj med god samvittighetProsjektet fokuserer på å spare på vannet og utnytte det på en bærekraftig måte.Skagerak Varme utilizes surplus energy from various sources such as wood chips, ocean heat, and industrial waste heat.The company aims to develop energy storage to optimize the use of heat more efficiently and multiple times.In 2022, Skagerak Varme faced financial challenges mainly due to the electricity subsidy scheme, which they must comply with but are not compensated for.The company's prices were not adjusted to match the extreme increase in electricity prices in 2022, and they will revise their pricing structure in 2023.Skagerak Varme uses 10 GWh of electricity per year for their facilities, primarily for heat generation through heat pumps.They experienced significant price variations, and they plan to introduce a discount scheme in the new pricing structure to mitigate the impact of high electricity prices.The text provides information about the ownership shares in subsidiary and associated companies of Skagerak Energi ASIt lists the companies, their headquarters, ownership percentages, balance sheet values, annual results, and equityThe text also mentions the treatment of shares in subsidiary and associated companies in the company's financial statementsIt includes a specification of balance sheet changes in associated companies in the Skagerak group, including estimated annual result shares and dividend received.Konsern Nettanlegg includes kraftanlegg, varmeanlegg, and buildingsThe balance value as of January 1, 2022, was 12,3 billion NOKNo new assets were acquired in 2022Assets were transferred between asset groupsBalanseførte låneutgifter (balance sheet loan costs) amounted to 1,664 million NOKDepreciation expenses were incurredThe balance value as of December 31, 2022, was 12.8 billion NOKForventet økonomisk levetid (expected economic life) varies depending on the asset categoryThe company received 5.2 million NOK in ENOVA grants in 2022 for fossil-free energy solutions and heating systems.Skagerak Energi AS has reported tax expenses for 2022, including payable income tax and payable resource rent tax.The company has received a decision from the Tax Appeals Board regarding amended tax settlements for 2008 and 2009.Skagerak Energi won the majority of its appeal, resulting in a tax refund of 123.8 million NOK.The payable resource rent tax for 2022 is reduced by 33.6 million NOK due to the tax-free income deduction.The resource rent tax rate will increase from 37% to 45% with retroactive effect for 2022, resulting in an increase of 464 million NOK.The resource rent tax rate for 2022 will be 57.7% due to the rate change.The effective tax rate for Skagerak Energi AS is 11.5% in 2022 compared to 21.5% in 2021.Skagerak Energi has ownership in 14 subsidiaries, subsidiary subsidiaries, and associated companiesInternal trade within the group is eliminated at the group levelStatkraft is the largest owner of SkagerakTransactions between Skagerak and Statkraft are conducted at arm's lengthA separate loan agreement has been established between Skagerak and StatkraftThe CEO listed in Note 6 is considered related to Skagerak EnergiOther members of the group's management are also considered related to Skagerak EnergiTransactions with related parties include only salary-related benefitsTransactions between the company and board members include approved board feesAll transactions with related parties are made on market termsSummary of transactions with related parties includes revenue and cost items for various subsidiaries and associated companiesAdditional explanation is provided on the nature of the transactions, including services such as accounting, rent, and HR servicesFinancial items primarily consist of interest on internal loans and interest on bank accounts associated with Statkraft's group accounts systemKraftsalgsinntekter for Skagerak konsern i 2022: 7,623,720Nettinntekter for Skagerak konsern i 2022: 1,034,202Brutto driftsinntekter for Skagerak konsern i 2022: 9,560,657Energikjøp for Skagerak konsern i 2022: -320,141Netto driftsinntekter for Skagerak konsern i 2022: 8,712,261Lønn og andre personalkostnader for Skagerak konsern i 2022: -637,943Regulatoriske kostnader for Skagerak konsern i 2022: -517,987Andre driftskostnader for Skagerak konsern i 2022: -754,562EBITDA for Skagerak konsern i 2022: 6,801,769EBIT for Skagerak konsern i 2022: 6,235,885Inntekt fra datterog tilknyttet selskap for Skagerak konsern i 2022: 39,026Finansinntekter for Skagerak konsern i 2022: 184,921Finanskostnader for Skagerak konsern i 2022: -149,828Skattekostnad for Skagerak konsern i 2022: -4,120,564Årsresultat for Skagerak konsern i 2022: 2,195,031Skagerak Kraft has been developing and producing renewable hydropower for over a hundred yearsThey believe that solar power and smart energy solutions will be important in solving the climate challengeThe company achieved record results after a year with the highest power prices everThey are facing political uncertainty which makes the operating conditions more unpredictableThe increase in grunnrenteskatt (ground rent tax) and høyprisbidrag (high-price contribution) will affect their investment capacity in the long termThey have several power plants where additional machines may be invested to increase efficiencySkagerak Kraft recently completed the Ala and Dalsfoss small hydropower plantsThey aim to contribute to Norway's need for more clean and renewable energy.Øivind Askvik is the CEO of LedeHe has 8 years of experience in the military and 15 years of experience in ABBAskvik has held several key positions in ABB, both nationally and internationallyHe has extensive experience in power products, power systems, and automationAskvik has been the CEO of Lede since 2017Geir Kulås is the CEO of production and energy managementHe has previous experience in Norsk Hydro in various positionsKulås has been the CEO of Skagerak Nett and Skagerak KraftHe holds a degree in industrial chemistry and an MBAKulås has been the CEO of production and energy management since 2020Tor Heiberg is the CEO of digitalization and ITHe previously worked as the CEO of Elhub and has experience from StatnettHe holds a degree in economics and has worked in the intersection of IT and the power industryHeiberg became the CEO of Skagerak in 2021Inger Anne Tho Bjørvik is the CEO of corporate strategy and CEO of Skagerak EnergipartnerShe previously worked as the marketing manager for Rambøll and has experience in strategy and business developmentBjørvik holds a degree in business administration and has been with Skagerak since 2021Skagerak Energi had a good financial result in 2022Challenges ahead include power shortages and insufficient grid capacitySkagerak Energi is committed to a green future and will work to address these challengesThe government and parliament have an important role in setting the framework and making difficult choices for electrification and achieving climate goals.The text contains notes related to various aspects of Skagerak Energi's financial statements.Note 1: Results by business areaNote 2: Sales revenues from powerNote 3: Storage and productionNote 4: Grid revenuesNote 5: Other operating revenuesNote 6: Salaries and other personnel expensesNote 7: Regulatory expensesNote 8: Other operating expensesNote 9: Financial expensesNote 10: TaxesNote 11: Results of related partiesNote 12: Intangible assetsNote 13: Tangible fixed assetsNote 14: Lease agreementsNote 15: Investments in subsidiaries and associatesNote 16: Financial instrumentsNote 17: Financial assets and liabilitiesNote 18: Pension liabilitiesNote 19: Other financial assetsNote 20: ReceivablesNote 21: Cash and cash equivalentsNote 22: EquityNote 23: Other provisions and liabilitiesNote 24: Interest-bearing long-term debtNote 25: Pledges and guaranteesNote 26: Interest-bearing short-term debtNote 27: Other non-interest-bearing short-term debtNote 28: Related party balancesNote 29: Market and financial riskNote 30: Significant events and other mattersNote 31: Subsequent events after the balance sheet dateThis is a list of the various notes included in Skagerak Energi's annual report for 2022. Each note provides detailed information on specific financial aspects of the company.The text provides information on fair value measurement at the end of 2022.It includes a breakdown of derivatives valued at fair value over the result, categorized into Level 1, Level 2, and Level 3.Energy derivatives, both long-term and short-term assets and liabilities, are listed with their respective fair values.Net energy derivatives value is calculated.Similar information is provided for interest rate derivatives and other financial assets valued at fair value over the result.The fair value of derivatives is further divided by time periods, including 2023 to after 2027.The value of positive and negative market value energy derivatives and a positive market value interest rate swap per time period is provided.The text also mentions the Skagerak Energi Annual Report 2022.The text is a specification of temporary differences and the calculation of deferred tax assets and deferred tax liabilities as of the balance sheet date.Deferred tax assets for the group Skagerak Energi AS increased from 204 652 to 211 153.Deferred tax liabilities for the group Skagerak Energi AS increased from 12 258 to 12 463.The balance sheet shows that deferred tax assets are recognized at full nominal value based on long-term projections of taxable profits.Deferred tax assets and liabilities are calculated based on future earnings.The balance sheet also includes deferred tax related to ground rent taxation, with a tax liability of 575 963 and a tax asset of 581 941.The specification of Konsern Skagerak Energi AS as of December 31, 2022, shows a decrease in pension liabilities compared to the previous year.The net pension assets have increased from the previous year.The net balance of pension assets has also increased.There has been a decrease in actuarial gains/losses recorded in the total result before tax compared to the previous year.Deferred tax related to actuarial gains/losses recorded in the total result after tax has also decreased.The composition of pension assets in the company's own pension fund shows a higher percentage of equity instruments and a lower percentage of interest-bearing instruments compared to the previous year.Transaksjoner med nærstående til Skagerak Energi konsernKraftsalgsinntekter fra ulike motparter inkludert Statkraft konsernet, Statnett konsernet, Å Energi konsernet, Eviny konsernet, Nape Kraft AS, og Air Liquide Skagerak ASNettinntekter fra Statkraft konsernet, Statnett konsernet, og Å Energi konsernetAndre driftsinntekter fra Statkraft konsernet, Statnett konsernet, Nape Kraft AS, Laugstol AS, Å Energi konsernet, Eviny konsernet, Air Liquide Skagerak AS, og Isola Solar ASOverføringskostnader fra Statkraft konsernet, Nape Kraft AS, Statnett konsernet, og Å Energi konsernetUrealiserte verdiendringer i kraftkontrakter fra Statkraft konsernetNetto driftsinntekterAndre driftskostnader fra Statnett konsernet, Statkraft konsernet, Laugstol AS, Where2O AS, Air Liquide Skagerak AS, Eviny konsernet, og Å Energi konsernetFinansinntekter fra Statkraft konsernet, Nape Kraftverk AS, Air Liquide Skagerak AS, Laugstol AS, Å Energi konsernet, Eviny konsernet, og Statnett konsernetFinanskostnader fra Statkraft konsernet, Statnett konsernet, og Å Energi konsernetNetto finansposterTotal sum of transactions for the yearSkagerak is exposed to various types of risks, including market risk, financial risk, and operational risk.Market risk is mainly associated with the production and trading of electricity, with variations in price and production capacity affecting the company's results.Skagerak has a financial strategy to manage interest rate risk, with a target duration of 2 to 5 years and a minimum of 25% and maximum of 75% of interest-bearing debt with a maturity of over one year. Jens Bjørn Staff is CEO of Skagerak Energi since 2020. Long-term interest rates are primarily between 5 to 15 years.Skagerak is indirectly exposed to currency risk through the sale of electricity on the Nord Pool exchange, which is priced in Euros. However, the company does not hedge this exposure.The company's financing needs are covered by Statkraft, and the terms and conditions are outlined in strategy documents and a framework agreement between Statkraft and Skagerak.Details of the maturity structure of interest-bearing debt to Statkraft, lease obligations, and derivative agreements are provided in the relevant notes.Skagerak Energi and the renewable energy industry had a challenging yearRising electricity prices, due to low water storage levels, among other reasonsRecognizes the need to explain the complex causes and find solutionsEmphasizes the importance of not losing sight of electrification and decarbonization goalsCalls for increased renewable power production in the systemCommitted to a green future and prepared for future challengesGautefall and Rauland ski resorts have installed fast chargers for winter guests to recharge their electric vehicles.The mobile fast chargers are a solution that saves the need for large charging facilities in destinations with high seasonal demand.The chargers are moved to coastal areas or other locations with high activity in the summer, such as campgrounds and festivals.The pilot project received positive feedback and the payment solution for customers is a regular card reader.By 2025, all construction sites in the transportation sector in major cities must operate without fossil fuel energy.Skagerak Energis introduced a pilot project for mobile energy at emission-free construction sites, allowing electric construction machines to be charged outside the power grid.Skagerak Energi has four charging containers with batteries and enough capacity to charge an electric machine with 360 kW per outlet.Skagerak Kraft AS has established a new company, Skagerak Energitjenester AS, to meet the increasing need for management, storage, and optimization of renewable energy sources.Low water levels in reservoirs due to low precipitation affected outdoor activities and resulted in high electricity prices.The low water levels affected not only Skagerak Kraft's reservoirs but also other major reservoirs in South Norway.The text discusses various aspects of the company Skagerak.It includes sections on the company's organization and management.Skagerak operates in sectors such as power and energy.The text also touches upon the company's market strategy and goals for the years 2021-2023.It mentions the development of new business areas and the focus on green transition.There is a section on the company's vision, values, and key figures from previous years.The text concludes with a brief overview of the company's history and its facilities.In the 2022 annual report of Skagerak Energi:The company has a long-term debt of 1,700,000The company has a supplier debt of 9,742There is a debt related to the Group office arrangement of 15,725There is other short-term debt of 283,373In the Statkraft Group:The group has a long-term debt of 1,700,000The group has a supplier debt of 23,954There is a debt related to the Group office arrangement of 15,725There is other short-term debt of 283,373In the Statnett Group:The company is a subsidiary of the Statkraft GroupThe company has a supplier debt of 2,984In the Laugstol AS:The company is an affiliated companyThe company has a supplier debt of 10,143In the Å Energi Group:The company is an affiliated company to the Statkraft GroupThe company has a supplier debt of 1,086In the 2021 annual report of Skagerak Energi:The company has a long-term debt of 2,352,629There is a debt related to the Group office arrangement of 143,786There is other short-term debt of 535,218In the Statkraft Group:The group has a long-term debt of 2,352,629There is a debt related to the Group office arrangement of 143,786There is other short-term debt of 535,218In the Statnett Group:The company is a subsidiary of the Statkraft GroupThe company has a supplier debt of 18,117In the Laugstol AS:The company is an affiliated companyThe company has a supplier debt of 12,981In the Eviny Group:The company is an affiliated company to the Statkraft GroupThe company has a supplier debt of 36In the Å Energi Group:The company is an affiliated company to the Statkraft GroupThe company has a supplier debt of 659The page is about Note 12 regarding intangible assets in 2022 for the company.It shows the balance value per 1.1 and 31.12 for Goodwill and Other intangible assets.There were no additions or disposals in 2022.The acquisition cost and accumulated depreciation for the assets are also given.Goodwill is related to the acquisition of network companies in Vestfold and the purchase of Hjartdal Elverk AS.The underlying network operations are considered long-term.The value of the assets is expected to have the same duration as the business itself.The assets are considered likely to provide economic benefits and are therefore capitalized.The portfolio of power trading customers was sold in 2021.Immovable assets with undefined useful life are not depreciated but evaluated annually or when circumstances require.Various assumptions are used in impairment assessments.No impairment of goodwill was done in 2022.A sensitivity analysis is provided for changes in expected excess return and discount rate.The specification of pension costs for Skagerak Energi AS in 2022 includes the following:   Benefit plans: NOK 49,845 in 2022 and NOK 44,067 in 2021   Present value of earned pension rights: NOK 10,682 in 2022 and NOK 9,604 in 2021   Interest costs on pension obligations: NOK 15,596 in 2022 and NOK 11,078 in 2021   Gross pension costs: NOK 26,278 in 2022 and NOK 20,682 in 2021   Plan changes and regulation adjustments resulted in changes in costs   Net pension costs for benefit plans: NOK 27,360 in 2022 and NOK 3,461 in 2021   Contribution plans: NOK 21,572 in 2022 and NOK 18,781 in 2021   Total pension costs: NOK 35,124 in 2022 and NOK 9,381 in 2021The total number of members in the scheme for Skagerak Energi AS as of December 31, 2022, was 370 for benefit plans and 335 for contribution plans.Economic assumptions for December 31, 2022, include an annual discount rate of 3.10%, wage growth of 3.50%, regulation of current pensions by 2.60%, and expected return on investments of 3.10%.Sensitivity analysis shows the impact of 1% changes in selected parameters on pension accrual and net pension obligations.The report includes the board's statement and financial accounts.Christina Endresen is a board member in Skagerak Energi, appointed by StatkraftShe has experience in leadership positions in Norwegian companies and currently works as CEO at Telenor InfraEndresen has education in philosophy and psychology from the University of Bergen and NTNU, and applied economic management from BIShe attended all 9 board meetings in 2022Gunnar Møane is an employee-elected board member in Skagerak Energi and has long work experience in the companyHe attended all 9 board meetings in 2022Kjersti Haugen is also an employee-elected board member with extensive work experience in Skagerak EnergiShe attended 8 out of 9 board meetings in 2022Trond Erling Johansen is an employee-elected board member with experience as an engineer and currently works as an energy engineerHe attended all 9 board meetings in 2022Hilde Bakken (former chairman) attended 5 out of 9 meetingsHeidi Therese Herum, Kristin Steenfeldt Foss, and Barbro Årvik (alternate members) each attended 1 out of 9 meetings.Rockeklubben i Porsgrunn (RiP) had the support of Skagerak Energi during the anniversary celebration in August 2022.Honningbarna performed on stage during the event. This information is mentioned in the Skagerak Energi Annual Report for 2022.The war in Ukraine has led to an increased focus on green transition in the EU through the initiative REPowerEU.Norway already has a high renewable production, therefore there is uncertainty about the extent and speed of the transition in Norway.There was dry weather and low water levels in the power reservoirs, such as Torsdalsdammen in Fyresdal, in the spring of 2022.Skagerak Energi published their annual report for 2022.Number of power outages per end user: 1.0 in 2022, 1.2 in 2021, 1.3 in 2020, 1.0 in 2019, 2.2 in 2018, 1.4 in 2017, 1.3 in 2016, 1.5 in 2015, 1.8 in 2014.Delivered heat in GWh (renewable share): 171 in 2022, 138 in 2021, 155 in 2020, 135 in 2019, 151 in 2018, 141 in 2017, 120 in 2016, 115 in 2015, 88 in 2014, with a long-term goal of 100% renewable.Number of damages to own employees: 0 in 2022, 4 in 2021, 5 in 2020, 1 in 2019, 6 in 2018, 2 in 2017, 2 in 2016, 4 in 2015, 7 in 2014.Sick leave rate: 3% in 2022, 3.8% in 2021, 2.9% in 2020, 3.1% in 2019, 2.9% in 2018, 3.6% in 2017, 4.3% in 2016, 3.1% in 2015, 3.7% in 2014.Waste sorting rate: 87% or higher in 2022, 86% in 2021, 89% in 2020, 87% in 2019, 86% in 2018, 87% in 2017, 80% in 2016, 85% in 2015, 65% in 2014.CO2 equivalent emissions: 0 tons in 2022, 2742 tons in 2021, 2266 tons in 2020, 2004 tons in 2019, 2845 tons in 2018, 2266 tons in 2017, 2104 tons in 2016, 1763 tons in 2015, 1987 tons in 2014.Number of serious environmental violations: 0 in 2022, 3 in 2021, 0 in 2020, 0 in 2019, 0 in 2018, 0 in 2017, 0 in 2016, 0 in 2015, 0 in 2014.Key focus areas: Infrastructure, Business development, Transition, Renewable energy, Energy efficiency, Human development, Green future, Reliable partner, Sustainable value creation, Nature conservation, Entrepreneurship, Productivity, Resource utilization, Chemicals, Waste, Procurement.Skagerak Energi has reported its financial indicators for the fiscal year 2022 in accordance with the EU taxonomy regulations.The report includes the percentage of activities that align with the taxonomy requirements and those that do not, measured by net operating income, investments, and operating costs.Skagerak Energi's main environmental goal is to combat climate change.The company has identified the economic activities that fall under the taxonomy definition for combating climate change.The report focuses on the electricity production from hydropower, primarily the power plants where Skagerak Kraft is the majority owner and included in the consolidated financial statements.The electricity production from the Skollenborg power plant and power plants in the Otravassdraget, where Skagerak Kraft is a minority owner with no operational responsibility, is not included in the 2022 report due to incomplete taxonomy mapping. It will be included in the 2023 report.The taxonomy covers six environmental goals: combating climate change, climate adaptation, sustainable use and protection of water and marine resources, transition to a circular economy, prevention and control of pollution, and protection and restoration of biodiversity and ecosystems.Economic activity data provided in millions of kronerBreakdown of net operating income, investments, and operating costs for various categories of activities related to electricity production and distributionSpecific details on electricity production from hydropower, electricity transformation and distribution, distribution of district heating/cooling, installation and operation of electric heat pumps, production of heat/cooling from bioenergy and waste heatTotal figures for activities that meet taxonomy requirements and activities that are covered but do not meet taxonomy requirementsSeparate figures for activities not covered by the taxonomyOverall totals for activities covered by the taxonomy and those not coveredSummary of proportions of activities that align with criteria and those that do notMention of social responsibility and sustainability.Dialog med interessenter og samarbeid er viktig for Skagerak EnergiTre kommuner i regionen har eierandeler i konsernetSkagerak Energi er en stor arbeidsgiver i regionen og en motor for verdiskapningUtbygging av vannkraft og strømnett påvirker økosystemer og landskapSkagerak Energi legger vekt på høy kompetanse og dialog med myndigheter, eiere, naturvernorganisasjoner, kunder, forretningspartnere, lokale foreninger og andre interessenterSkagerak Energi vurderer vesentlige områder for samfunnsoppdraget og forvaltning av naturressurseneAktiv kommunikasjonspolitikk rettet mot allmennhetenSikre liv og helse, etikk og integritetSikker og stabil energiforsyningBærekraftig produksjon, vekst og utviklingMotiverte og kompetente medarbeidereForskning og teknologiutviklingKommunikasjon med interessenterInformasjonsog IT-sikkerhetAnsvarlig leverandørstyringØkonomiske bidrag til regionen gjennom skatter, avgifter, arbeidsplasser, anskaffelser og støtte til organisasjonsog kulturliv.Kagerak har utviklet sitt eget scenarioverktøy for å kartlegge, forstå og reagere på trender og beskrive ulike mulige framtider.Troen på at særlig EU går i retning av et scenario som kalles "Grønn konsensus" har forsterket seg i 2022.Etter at 40 prosent av gassforsyningen til EU forsvant, har arbeidet med å øke produksjonen av fornybar energi akselerert.I 2021 kom EU med lovpakken "Fit for 55", som er en helhetlig plan for å innfri EUs grønne vekststrategi fra 2019.I 2022 kom initiativet "REPowerEU" som øker ambisjonsnivået og legger til rette for energisparing, økt produksjon av fornybar energi og økt antall kilder og leverandører av energi.EU har en tydelig vei mot grønn omstilling, mens Norge er ikke like tydelig på grunn av ulik situasjon.Statnett presenterte at den nasjonale energibalansen kan bli negativ i 2027, og det må tas et krafttak for å bygge ut ny fornybar produksjon for å nå klimagassutslippsmålet.Norges vassdragsog energidirektorat (NVE) mener det realistiske potensialet for ny norsk vannkraft er begrenset, og det er kun tre alternativer for å bygge ut mye kraft innen 2030.Røra music festival in Skien, Porsgrunn, managed to reduce its carbon emissions by over two tons by using batteries that typically power electric excavatorsSkagerak Energi provided renewable energy and financial support to the festivalSkagerak Energi sponsors both men's and women's football teams at Odds Ballklubb and has a presence in the stadium's solar panels and battery bankThe company also sponsors Rockeklubben in Porsgrunn and supported a street festival with 1000 attendeesSkagerak Energi's aid project in Kenya supports education, particularly for girls, and fights against child marriage and female genital mutilation.Brutto driftsinntekter økte med 44% fra 2021 til 2022.Driftsresultat før avog nedskrivninger (EBITDA) økte med 39% fra foregående år.Resultatet etter skatt økte med 16%.Rekordhøye kraftpriser bidro til høyere omsetning i kraftselskapet.Nettvirksomheten hadde høyere netto driftsinntekt på grunn av høye kraftpriser og tariffstøtte.Skagerak Kraft ferdigstilte og igangsatte to nye vannkraftverk.Skagerak Energitjenester AS ble etablert for optimalisering og effektivisering av energibruk for næringskunder.Konsernet har investert i Where2O AS, Evyon AS og Isola Solar AS for å utvikle energirelaterte produkter og tjenester.Konsernets arbeid med nye vekstmuligheter er forsterket gjennom året.Skagerak Energi er et regionalt energikonsern med kjernevirksomhet innen kraftproduksjon, distribusjon av strøm og produksjon og distribusjon av fjernvarme.Skagerak Kraft driver vannkraftproduksjon i Sør-Norge.Skagerak Varme driver fjernvarmevirksomhet i Vestfold og Telemark.Konsernet eier også flere datterselskaper og andeler i selskaper innen energisektoren.Skagerak Energis visjon er å være en framtidssikret leverandør av ren energi.Konsernets forretningsidé er å skape verdier ved å produsere, transportere og selge energi, og utvikle og levere energirelaterte produkter og tjenester.Fjernvarme er en smart løsning av flere grunner.Det utnytter energi som ellers ville gått tapt.Det avlaster kraftnettet.Fjernvarme fraktes under bakken til forretninger, fabrikker og folk.Det er en beretning og regnskap fra styret.Skagerak Varme and Ledes adhere to relevant standards and government requirements for pollution prevention and control.Skagerak Group meets the criteria for the protection of biodiversity through sector regulations, concession processes, and government requirements for environmental impact assessments.The company respects international human rights and labor rights, supports the elimination of forced labor and child labor, and seeks to eliminate discrimination in employment.Skagerak Group has ethical guidelines that promote sustainability, ethical behavior, and social responsibility.No cases of human rights violations, serious labor rights violations, significant breaches of corruption or bribery provisions, competition laws, or tax laws have been confirmed during the reporting period.Financial indicators such as net operating income, investments, and operating costs are calculated in accordance with the standards used in the group's financial statements.In 2022, the total net operating income for Skagerak Group was 8712 million kroner, with nearly 100% coming from activities covered by the taxonomy. 84% of the income met the screening criteria and fulfilled the requirements of the taxonomy.Beredskapsmøter har økt i hyppighetFokus på å være våkne og forberedtNVE har advart energibransjen mot "spoofing" eller mobilkapringSpoofing involverer svindlere som maskeerer nummeret de ringer fraMålet er å lure virksomheter til å gi ut informasjon de vanligvis ikke ville ha gitt utSkagerak Energi Årsrapport 2022 omtaler disse hendelsene (uten detaljer)Historically high electricity prices in 2022Nearly 75% of value creation goes to the government as owners, tax collectors, and host municipalitiesSkagerak Energi has both direct and indirect public ownershipSkatt (taxes) and avgifter (fees) amounted to 4.7 billion NOK in 2022Dividends were 1.139 billion NOK, and retained surplus was 1.128 billion NOKPublic entities retain 94% of the value creation, amounting to 7.156 billion NOKSkien, Porsgrunn, and Bamble will receive approximately 380 million NOK in dividendsLocal economy benefited from approximately 880 million NOK in demand for goods and servicesSkagerak Energi supported the local economy with nearly 14 billion NOK in the past 10 yearsSkatt and avgifter paid by Skagerak Energi and its employees amounted to 4.7 billion NOK in 2022This amount could cover the salaries of 7,000 positions in health and education fields.Dialogtabellen viser hvilke interessentgrupper som er involvert i dialogen med Skagerak Energi.Myndighetene er opptatt av sikker og stabil energiforsyning, sikre anlegg, og ansvarlig drift og utbygging i tråd med regelverk og tillatelser.Eierne (Statkraft og kommunene Skien, Porsgrunn og Bamble) ønsker sikker, effektiv og ansvarlig produksjon og distribusjon av klimavennlig og fornybar energi.Ansatte vektlegger sikkerhet på arbeidsplassen, medbestemmelse, jobbsikkerhet, kompetanseutvikling og omdømme.Kunder forventer sikker og stabil energiforsyning, er opptatt av prisnivå og omdømme.Vertskommunene ønsker sikker, effektiv og ansvarlig drift, skånsomme naturinngrep og ivaretagelse av naturmangfold.Lokalbefolkningen ønsker sikre anlegg, skånsomme naturinngrep og sikre og trygge arbeidsplasser.Naturverninteresser og organisasjoner vil sikre anlegg, skånsomme naturinngrep og delta i dialog ved revisjoner og nye konsesjoner.Skoler, universiteter og forskningsinstitusjoner vektlegger kompetanseog teknologiutvikling, praksisplasser, samarbeidsmuligheter og omdømme.Bransjeorganisasjoner fokuserer på HMS, miljø/klima, beredskap, samfunnsansvar, lønnsomhet og rammebetingelser.Leverandører og forretningspartnere vektlegger forretningsetikk i anskaffelser, omdømme, kompetanse og prestisjeprosjekter, betalingsevne og -villighet.Alle interessentgruppene deltar i formaliserte og ad-hoc møter samt dialoger, informasjonstiltak og samarbeidsprosjekter med Skagerak Energi.Brutto driftsinntekter økte med 44% fra 2021 til 2022, til 9561 millioner kroner.Driftsresultatet før avog nedskrivninger (EBITDA) økte med 39% fra foregående år, til 6802 millioner kroner.Resultatet etter skatt økte med 16% til 2195 millioner kroner.Konsernet investerte i Where2O AS og Evyon AS for å forbedre overvåking og styring av vannmagasiner og gjenbruke bilbatterier.
"""


@cl.on_settings_update
async def setup_agent(settings):
    print("on_settings_update", settings)


@cl.on_chat_start
async def start_chat():
    cl.user_session.set(
        "message",
        [
            {
                "role": "system",
                "content": """
                        Du er en høflig og informativ norsk chatbot, som har jobb å oppsummere Skagerak sin årsrapport.
                        """,
            }
        ],
    )
    message_history = user_session.get("message")

    settings = await cl.ChatSettings(
        [
            Select(
                id="Model",
                label="OpenAI - Model",
                values=["gpt-3.5-turbo-16k", "gpt-3.5-turbo", "gpt-4", "gpt-4-32k"],
                initial_index=0,
            ),
            # Switch(id="Streaming", label="OpenAI - Stream Tokens", initial=True),
            Slider(
                id="Temperature",
                label="OpenAI - Temperature",
                initial=0.3,
                min=0,
                max=2,
                step=0.1,
                tooltip="Øke kreativitet til outputen (0=mindre kreativ, 2=ekstrem kreativ)",
            ),
        ]
    ).send()

    if len(message_history) > 4:
        logger.warning("DELETING CONTEXT")
        message_history.pop(1)  #  User input
        message_history.pop(1)  #  Assistant output


@cl.on_message
async def main(message: str):
    source_data = "./lede_årsrapport/ledechat/SkagerakEnergi_2022.pdf"

    elements = [cl.Pdf(name="Skagerak Energi", display="side", path=source_data)]

    msg = cl.Message(
        content="",
        elements=elements,
    )

    txt = ""
    prompt = """ Bruk dette dokumentet: {skagerak}, til å svare på dette: {question}"""

    fromatted_prompt = prompt.format(skagerak=skagerak_report_txt, question=message)
    message_history = user_session.get("message")

    message_history.append({"role": "user", "content": fromatted_prompt})
    print(message_history)
    # msg = cl.Message(content=output["choices"][0]["message"]["content"])

    logger.error(message_history)
    async for stream_resp in await openai.ChatCompletion.acreate(
        model=model_engine, messages=message_history, stream=True, **settings
    ):
        # token = stream_resp.get("choices")[0].get("text")
        token = stream_resp.choices[0]["delta"].get("content", "")

        txt += token
        await msg.stream_token(token)
    logger.info(txt)

    #message_history = user_session.get("message")
    #message_history.append({"role": "assistant", "content": txt})
    #user_session.set("message", message_history)
    # logger.debug(message_history)

    #if len(message_history) > 2:
    #   logger.warning("DELETING CONTEXT")
    message_history.pop(1)  #  User input
        #message_history.pop(1)  #  Assistant output

